<?php

/**
 * <Comment>.
 *
 * @package Shop
 * @author Konstantin Shamiev aka ilosa <konstantin@shamiev.ru>
 * @date 2015-02-04
 */
class Shop_PresetContainerVPS extends Zero_Model
{
    /**
     *
     * Template presets array
     *
     * @var array $preset
     */
    private $preset_template = [
        [
            'name' => 'RU VDS',
            'id' => 0,
            'hidden' => 0,
            'value' => '1/1/25',
            'PID' => 538,
            'summ' => 0,
            'sort' => 1,
            '0' => [
                '742' => ['data' => ['0' => ['id' => 6261]]],
                '745' => ['data' => ['0' => ['id' => 6270]]],
                '746' => ['data' => ['0' => ['id' => 7975]]],
                '747' => ['data' => ['0' => ['id' => 6283]]],
                '748' => ['data' => ['0' => ['id' => 6289]]],
                '750' => ['data' => ['0' => ['id' => 6297]]]
            ]
        ],
        [
            'name' => 'RU VDS',
            'id' => 0,
            'hidden' => 0,
            'value' => '2/2/50',
            'PID' => 538,
            'summ' => 0,
            'sort' => 2,
            '0' => [
                '742' => ['data' => ['0' => ['id' => 6262]]],
                '745' => ['data' => ['0' => ['id' => 6271]]],
                '746' => ['data' => ['0' => ['id' => 6277]]],
                '747' => ['data' => ['0' => ['id' => 6283]]],
                '748' => ['data' => ['0' => ['id' => 6289]]],
                '750' => ['data' => ['0' => ['id' => 6297]]]
            ]
        ],
        [
            'name' => 'RU VDS',
            'id' => 0,
            'hidden' => 0,
            'value' => '4/4/100',
            'PID' => 538,
            'summ' => 0,
            'sort' => 3,
            '0' => [
                '742' => ['data' => ['0' => ['id' => 6263]]],
                '745' => ['data' => ['0' => ['id' => 6272]]],
                '746' => ['data' => ['0' => ['id' => 6278]]],
                '747' => ['data' => ['0' => ['id' => 6283]]],
                '748' => ['data' => ['0' => ['id' => 6289]]],
                '750' => ['data' => ['0' => ['id' => 6297]]]
            ]
        ],
        [
            'name' => 'RU VDS',
            'id' => 0,
            'hidden' => 0,
            'value' => '8/8/200',
            'PID' => 538,
            'summ' => 0,
            'sort' => 4,
            '0' => [
                '742' => ['data' => ['0' => ['id' => 6265]]],
                '745' => ['data' => ['0' => ['id' => 6273]]],
                '746' => ['data' => ['0' => ['id' => 6279]]],
                '747' => ['data' => ['0' => ['id' => 6283]]],
                '748' => ['data' => ['0' => ['id' => 6289]]],
                '750' => ['data' => ['0' => ['id' => 6297]]]
            ]
        ],
        [
            'name' => 'Container VPS<br/>NL 1/256/10',
            'id' => 0,
            'hidden' => 0,
            'value' => '1/256/10',
            'PID' => 530,
            'summ' => 0,
            'sort' => 0,
            '0' => [
                '686' => ['data' => ['0' => ['id' => 5222]]],
                '689' => ['data' => ['0' => ['id' => 5228]]],
                '690' => ['data' => ['0' => ['id' => 5231]]],
                '691' => ['data' => ['0' => ['id' => 5233]]],
                '693' => ['data' => ['0' => ['id' => 5240]]],
                '695' => ['data' => ['0' => ['id' => 5249]]],
                '696' => ['data' => ['0' => ['id' => 5253]]],
            ]
        ],
        [
            'name' => 'Container VPS<br/>NL 1/1/10',
            'id' => 0,
            'hidden' => 0,
            'value' => '1/1/10',
            'PID' => 530,
            'summ' => 0,
            'sort' => 0,
            '0' => [
                '686' => ['data' => ['0' => ['id' => 5222]]],
                '689' => ['data' => ['0' => ['id' => 5230]]],
                '690' => ['data' => ['0' => ['id' => 5231]]],
                '691' => ['data' => ['0' => ['id' => 5233]]],
                '693' => ['data' => ['0' => ['id' => 5240]]],
                '695' => ['data' => ['0' => ['id' => 5249]]],
                '696' => ['data' => ['0' => ['id' => 5253]]]
            ]
        ],
        [
            'name' => 'Container VPS<br/>NL 2/2/20',
            'id' => 0,
            'hidden' => 0,
            'value' => '2/2/20',
            'PID' => 530,
            'summ' => 0,
            'sort' => 0,
            '0' => [
                '686' => ['data' => ['0' => ['id' => 5223]]],
                '689' => ['data' => ['0' => ['id' => 5258]]],
                '690' => ['data' => ['0' => ['id' => 5232]]],
                '691' => ['data' => ['0' => ['id' => 5233]]],
                '693' => ['data' => ['0' => ['id' => 5240]]],
                '695' => ['data' => ['0' => ['id' => 5249]]],
                '696' => ['data' => ['0' => ['id' => 5253]]],
            ]
        ],
        [
            'name' => 'Container VPS<br/>NL 2/4/40',
            'id' => 0,
            'hidden' => 0,
            'value' => '2/4/40',
            'PID' => 530,
            'summ' => 0,
            'sort' => 0,
            '0' => [
                '686' => ['data' => ['0' => ['id' => 5223]]],
                '689' => ['data' => ['0' => ['id' => 5259]]],
                '690' => ['data' => ['0' => ['id' => 5262]]],
                '691' => ['data' => ['0' => ['id' => 5233]]],
                '693' => ['data' => ['0' => ['id' => 5240]]],
                '695' => ['data' => ['0' => ['id' => 5249]]],
                '696' => ['data' => ['0' => ['id' => 5253]]],
            ]
        ],
        [
            'name' => 'Container VPS<br/>NL 4/8/100',
            'id' => 0,
            'hidden' => 0,
            'value' => '4/8/100',
            'PID' => 530,
            'summ' => 0,
            'sort' => 0,
            '0' => [
                '686' => ['data' => ['0' => ['id' => 5255]]],
                '689' => ['data' => ['0' => ['id' => 5260]]],
                '690' => ['data' => ['0' => ['id' => 5264]]],
                '691' => ['data' => ['0' => ['id' => 5233]]],
                '693' => ['data' => ['0' => ['id' => 5240]]],
                '695' => ['data' => ['0' => ['id' => 5249]]],
                '696' => ['data' => ['0' => ['id' => 5253]]],
            ]
        ],
        [
            'name' => 'NL VDS',
            'id' => 0,
            'hidden' => 0,
            'value' => '1/1/25',
            'PID' => 531,
            'summ' => 0,
            'sort' => 1,
            '0' => [
                '698' => ['data' => ['0' => ['id' => 5285]]],
                '701' => ['data' => ['0' => ['id' => 5291]]],
                '702' => ['data' => ['0' => ['id' => 7974]]],
                '703' => ['data' => ['0' => ['id' => 5295]]],
                '704' => ['data' => ['0' => ['id' => 5297]]],
                '706' => ['data' => ['0' => ['id' => 5303]]],
                '753' => ['data' => ['0' => ['id' => 7849]]]
            ]
        ],
        [
            'name' => 'NL VDS',
            'id' => 0,
            'hidden' => 0,
            'value' => '2/2/50',
            'PID' => 531,
            'summ' => 0,
            'sort' => 2,
            '0' => [
                '698' => ['data' => ['0' => ['id' => 5286]]],
                '701' => ['data' => ['0' => ['id' => 5292]]],
                '702' => ['data' => ['0' => ['id' => 5293]]],
                '703' => ['data' => ['0' => ['id' => 5295]]],
                '704' => ['data' => ['0' => ['id' => 5297]]],
                '706' => ['data' => ['0' => ['id' => 5303]]],
                '753' => ['data' => ['0' => ['id' => 7849]]]
            ]
        ],
        [
            'name' => 'NL VDS',
            'id' => 0,
            'hidden' => 0,
            'value' => '2/8/100',
            'PID' => 531,
            'summ' => 0,
            'sort' => 3,
            '0' => [
                '698' => ['data' => ['0' => ['id' => 5286]]],
                '701' => ['data' => ['0' => ['id' => 5312]]],
                '702' => ['data' => ['0' => ['id' => 5294]]],
                '703' => ['data' => ['0' => ['id' => 5295]]],
                '704' => ['data' => ['0' => ['id' => 5297]]],
                '706' => ['data' => ['0' => ['id' => 5303]]],
                '753' => ['data' => ['0' => ['id' => 7849]]]
            ]
        ],
        [
            'name' => 'NL VDS',
            'id' => 0,
            'hidden' => 0,
            'value' => '4/8/100',
            'PID' => 531,
            'summ' => 0,
            'sort' => 4,
            '0' => [
                '698' => ['data' => ['0' => ['id' => 5308]]],
                '701' => ['data' => ['0' => ['id' => 5312]]],
                '702' => ['data' => ['0' => ['id' => 5294]]],
                '703' => ['data' => ['0' => ['id' => 5295]]],
                '704' => ['data' => ['0' => ['id' => 5297]]],
                '706' => ['data' => ['0' => ['id' => 5303]]],
                '753' => ['data' => ['0' => ['id' => 7849]]]
            ]
        ],
        [
            'name' => 'NL VDS',
            'id' => 0,
            'hidden' => 0,
            'value' => '4/16/100',
            'PID' => 531,
            'summ' => 0,
            'sort' => 5,
            '0' => [
                '698' => ['data' => ['0' => ['id' => 5308]]],
                '701' => ['data' => ['0' => ['id' => 5313]]],
                '702' => ['data' => ['0' => ['id' => 5294]]],
                '703' => ['data' => ['0' => ['id' => 5295]]],
                '704' => ['data' => ['0' => ['id' => 5297]]],
                '706' => ['data' => ['0' => ['id' => 5304]]],
                '753' => ['data' => ['0' => ['id' => 7849]]]
            ]
        ],
        [
            'name' => 'NL VDS',
            'id' => 0,
            'hidden' => 0,
            'value' => '8/32/200',
            'PID' => 531,
            'summ' => 0,
            'sort' => 6,
            '0' => [
                '698' => ['data' => ['0' => ['id' => 5310]]],
                '701' => ['data' => ['0' => ['id' => 5314]]],
                '702' => ['data' => ['0' => ['id' => 5316]]],
                '703' => ['data' => ['0' => ['id' => 5295]]],
                '704' => ['data' => ['0' => ['id' => 5297]]],
                '706' => ['data' => ['0' => ['id' => 5326]]],
                '753' => ['data' => ['0' => ['id' => 7849]]]
            ]
        ],
        [
            'name' => 'Container VPS<br/>RU 1/256/10',
            'id' => 0,
            'hidden' => 0,
            'value' => '1/256/10',
            'PID' => 538,
            'summ' => 0,
            'sort' => 1,
            '0' => [
                '719' => ['data' => ['0' => ['id' => 6152]]],
                '722' => ['data' => ['0' => ['id' => 6161]]],
                '723' => ['data' => ['0' => ['id' => 6167]]],
                '724' => ['data' => ['0' => ['id' => 6174]]],
                '726' => ['data' => ['0' => ['id' => 6182]]],
                '728' => ['data' => ['0' => ['id' => 9977]]],
                '729' => ['data' => ['0' => ['id' => 12242]]]

            ]
        ],
        [
            'name' => 'Container VPS<br/>RU 1/1/30',
            'id' => 0,
            'hidden' => 0,
            'value' => '1/1/30',
            'PID' => 538,
            'summ' => 0,
            'sort' => 2,
            '0' => [
                '719' => ['data' => ['0' => ['id' => 6152]]],
                '722' => ['data' => ['0' => ['id' => 6163]]],
                '723' => ['data' => ['0' => ['id' => 6169]]],
                '724' => ['data' => ['0' => ['id' => 6174]]],
                '726' => ['data' => ['0' => ['id' => 6182]]],
                '728' => ['data' => ['0' => ['id' => 9977]]],
                '729' => ['data' => ['0' => ['id' => 12242]]]
            ]
        ],
        [
            'name' => 'Container VPS<br/>RU 2/2/40',
            'id' => 0,
            'hidden' => 0,
            'value' => '2/2/40',
            'PID' => 538,
            'summ' => 0,
            'sort' => 3,
            '0' => [
                '719' => ['data' => ['0' => ['id' => 6153]]],
                '722' => ['data' => ['0' => ['id' => 6164]]],
                '723' => ['data' => ['0' => ['id' => 6170]]],
                '724' => ['data' => ['0' => ['id' => 6174]]],
                '726' => ['data' => ['0' => ['id' => 6182]]],
                '728' => ['data' => ['0' => ['id' => 9977]]],
                '729' => ['data' => ['0' => ['id' => 12242]]]
            ]
        ],
        [
            'name' => 'Container VPS<br/>RU 2/4/50',
            'id' => 0,
            'hidden' => 0,
            'value' => '2/4/50',
            'PID' => 538,
            'summ' => 0,
            'sort' => 4,
            '0' => [
                '719' => ['data' => ['0' => ['id' => 6153]]],
                '722' => ['data' => ['0' => ['id' => 6165]]],
                '723' => ['data' => ['0' => ['id' => 6171]]],
                '724' => ['data' => ['0' => ['id' => 6174]]],
                '726' => ['data' => ['0' => ['id' => 6182]]],
                '728' => ['data' => ['0' => ['id' => 9977]]],
                '729' => ['data' => ['0' => ['id' => 12242]]]
            ]
        ],
        [
            'name' => 'Container VPS<br/>RU 4/8/100',
            'id' => 0,
            'hidden' => 0,
            'value' => '4/8/100',
            'PID' => 538,
            'summ' => 0,
            'sort' => 5,
            '0' => [
                '719' => ['data' => ['0' => ['id' => 6154]]],
                '722' => ['data' => ['0' => ['id' => 6166]]],
                '723' => ['data' => ['0' => ['id' => 6172]]],
                '724' => ['data' => ['0' => ['id' => 6174]]],
                '726' => ['data' => ['0' => ['id' => 6182]]],
                '728' => ['data' => ['0' => ['id' => 9977]]],
                '729' => ['data' => ['0' => ['id' => 12242]]]
            ]
        ]
    ];

    /**
     *
     * Template array for sort to Cloud VDS page
     *
     * @var array
     */
    private $sortCloudVDS_template = [
        '531' => [
            'name' => 'cloud vds Configurator',
            'data' => [
                '0' => [
                    'data' => [
                        'configoption' => '698',
                        'name' => 'CPU Cores'
                    ]
                ],
                '1' => [
                    'data' => [
                        'configoption' => '701',
                        'name' => 'Amount of RAM'
                    ]
                ],
                '2' => [
                    'data' => [
                        'configoption' => '702',
                        'name' => 'Disk Space'
                    ]
                ],
                '5' => [
                    'data' => [
                        'configoption' => '704',
                        'name' => 'IPv4 Addresses'
                    ]
                ],
                '4' => [
                    'data' => [
                        'configoption' => '706',
                        'name' => 'Backups Limit'
                    ]
                ],
                '3' => [
                    'data' => [
                        'configoption' => '703',
                        'name' => 'Bandwidth Limit [GB]'
                    ]
                ]
            ]
        ],
        '539' => [
            'name' => 'cloud vds Configurator',
            'data' => [
                '0' => [
                    'data' => [
                        'configoption' => '742',
                        'name' => 'CPU Cores'
                    ]
                ],
                '1' => [
                    'data' => [
                        'configoption' => '745',
                        'name' => 'Amount of RAM'
                    ]
                ],
                '2' => [
                    'data' => [
                        'configoption' => '746',
                        'name' => 'Disk Space'
                    ]
                ],
                '5' => [
                    'data' => [
                        'configoption' => '748',
                        'name' => 'IPv4 Addresses'
                    ]
                ],
                '4' => [
                    'data' => [
                        'configoption' => '750',
                        'name' => 'Backups Limit'
                    ]
                ],
                '3' => [
                    'data' => [
                        'configoption' => '747',
                        'name' => 'Bandwidth Limit [GB]'
                    ]
                ]
            ]
        ]
    ];

    /**
     *
     * Returns the array received by superimposing of an array of template on custom array
     *
     * @param null|array $container_VPS_custom
     * @param array $billingcycle----reserve
     * @return array
     */
    public function getPreset($container_VPS_custom = null, $billingcycle = ['monthly' => 0] )
    {
        if ( is_null($container_VPS_custom) )
        {
            return $this->preset_template;
        }
        else
        {
            $a = [];
            foreach ($this->preset_template as $k => $v)
            {//level Preset{ name, id, value...}
                foreach ($v[0] as $key => $val)
                {//level Options key = configoption[...]
                    $ID = $val['data'][0]['id'];// id producta in Options
                    foreach ($container_VPS_custom as $key_custom => $val_custom)
                    {//Level Options in custom

                        if ( $key_custom == $key )
                        {// option = option
                            if ( !isset($a[$k])  )
                            {
                               $a[$k] = $this->preset_template[$k];
                            }
                            foreach ($val_custom['data'] as $key_product => $val_product)
                            {
                               //pre ( $ID."---".$val_product['id'] );
                            if ( $ID == $val_product['id'] ) {
                                $a[$k][0][$key]['name'] = $val_custom ['name'];
                                $a[$k][0][$key]['hidden'] = $val_custom ['hidden'];
                                $a[$k][0][$key]['data'][0] = $val_product;// ID product template = ID product custom merge array to template
                            } else {
                                if(  $ID == 'NONE' )
                                {
                                    foreach ( $val_product as $key_bb => $val_bb ){

                                        $a[$k][0][$key]['data'][0][$key_bb] = '0';

                                        if ( $key_bb == 'name') {
                                            $a[$k][0][$key]['data'][0]['name'] = 'NONE';
                                        }
                                        if ( $key_bb == 'id') {
                                            $a[$k][0][$key]['data'][0]['id'] = 'NONE';

                                        }

                                    }
                                    $a[$k][0][$key]['name'] = $val_custom ['name'];
                                    $a[$k][0][$key]['hidden'] = $val_custom ['hidden'];

                                }
                            }

                                    //$a[$k][0][$key]['name'] = $val_custom ['name'];
                                 //  $a[$k][0][$key]['hidden'] = $val_custom ['hidden'];
                            }
                        }
                    }
                }
            }
        }
      //  pre ( json_encode( $a) ); die;
        foreach ($a as $k => $v)
        {
            foreach ($v[0] as $key => $val)//Produts PID
            {
                $a[$k]['summ'] = $a[$k]['summ'] + $val['data'][0][key($billingcycle)];
            }
        }
        return $a;
    }

    /**
     *
     * Returns the array of values sorted by increase received from superimposing of an array of template on custom array
     *
     * @param null|array $container_VPS_custom
     * @param null|int $PID
     * @return array
     */
    public function getSortCloudVDS($container_VPS_custom = null, $PID = null)
    {
        if ( is_null($container_VPS_custom) )
        {
            return $this->sortCloudVDS_template;
        }
        else
        {
            $a = array();
            foreach ($this->sortCloudVDS_template[$PID]['data'] as $key => $value)
            {
                if ( isset($container_VPS_custom[$value['data']['configoption']]) )
                {
                    $a[$key][$value['data']['configoption']] = $container_VPS_custom[$value['data']['configoption']];
                }
            }
        }
        ksort($a);
        $b = array();
        foreach ($a as $key => $value)
        {
            $b[key($value)] = $value[key($value)];
        }
        return $b;
    }

    /**
     * Фабрика по созданию объектов.
     *
     * @param integer $id идентификатор объекта
     * @param bool $flagLoad флаг полной загрузки объекта
     * @return Shop_PresetContainerVPS
     */
    public static function Make($id = 0, $flagLoad = false)
    {
        return new self($id, $flagLoad);
    }
}
